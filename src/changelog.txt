/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.031>
//  <16.04. 2001  11:10>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации 
//
//  <Проблема>: При дабавлении нового столбца или строчки программа не находила 
//  существующие столбцы и сторочки.              
//  <Причина>:  [TransformLogCrd(...)] ;  step = m_ColMap.GetCount(); при
//   поиске нужной строчки или столбца в Excel таблице.
//   Считалось, что если столбец или строчка не сущ., то и все последующие 
//   строчки и столбцы не существуют, что является логической ошибкой
//   <Решение>:     
//            строчку:  step = m_ColMap.GetCount();  заменили на step = 0;
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.032>
//  <26.04. 2001  13:16>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: балансовские счета (строчки типа "04-12") преобразуются к датам 
// 
//  <Причина>:  так работат в Excel стандартная функция SetFormula(...) 
//
//   <Решение>: функция converNumber при обнаружении строчки подобного
//                      типа добавляет в конец символ "|"
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.033>
//  <4.05. 2001  17:21>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: если строчка форматирования начинается с пробелов
//                         происходит перемешивание столбцов
//  <Причина>:  первые пробелы учитываются при разборе
//
//   <Решение>: функция converList определяет сдвиг таблицы; у всех
//                        строчек вырезает столько же первых сиволов 
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.034>
//  <10.05. 2001  10:00>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: Если не указан лист, то программа валится
//  <Причина>:  Ошибка в программе - не правильная праверка количества 
//                         параметров передаваемых в командной строке .
//                         m_buff.GetSize() >= n ... далее шло m_buff[n] 
//
//   <Решение>: Исправил в нужных местах на m_buff.GetSize() > n
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.034>
//  <10.05. 2001 11:27>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: Символ табуляции конвертируется неправильно в 1 пробел
//  <Причина>:  Не было договоренности как его интерпретировать
//
//   <Решение>: Интерпретация табуляции в файле конфигурации; 
//                        по умолчанию 4
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.035>
//  <16.05. 2001 9:58>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации и прямой адресации
//
//  <Проблема>: Символ ":" служит для определения логической адрессации
//                          и задания региона - это привело к тому, что задать регион
//                          стало не возможно.
//  <Причина>:  Забыл про эту особенность задания регионов 
//
//   <Решение>: В качестве символа разделителя в логической адрессации
//                        теперь используется "::"
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.036>
//  <16.05. 2001 15:02>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации
//
//  <Проблема>: Необходима возможность в логической адрессации добавить 
//                         возможность использовать числовые смещения от заданной ячейки.
//  <Причина>:  
//   <Решение>:  Добавлена необходимая функциональность.  При аналоговой адрессации
//                         в фигурных скобках указывается смещение. Смещение может быть
//                         как положительное, так и отрицательное. В том случае, если не указано
//                         название ряда или столбца смещение высчитывается от левого верхнего
//                         угла таблицы, описанного в поле Prim .
//    <Пример>:  Col{+1}::Row{+20}
//                        Col{+5}::{+15}           
//                        {+4}::{-15}                           
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.037>     <21.05. 2001 10:02>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации
//
//  <Проблема>: Низкая скорость поиска нужной ячейки
//
//  <Причина>:  Поиск строки и столбца начинается с начала таблицы
//   <Решение>:  Необходимо сначала инициализировать таблицу преобразований
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.037>     <21.05. 2001 16:20>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации
//
//  <Проблема>: Необходим добавиь возможность скрывать, открывать строчки
//                         и столбцы.
//  <Причина>:  
//   <Решение>:  Добавленна необходимая функциональность. В поле Prim
//                          после ":" можно указать необходимую команду (Row(Col)Hide(Show))
//   <Пример:>   "A1 : RowHide"
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.038>     <21.05. 2001 16:20>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: Несовместимость с генератором отчетов, в частности как определять
//                         конец таблицы, не преобразует символ "={=".
//  <Причина>:  Отсутствие договоренности
//   <Решение>:  Обрабатывам  спец. сиволы, принятые в программе печати
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.039>     <8.06. 2001 14:24>
//
//  <Логический модуль>: все модули
//
//  <Проблема>: Если при работе конвертера закрывают Excel или вторая
//                         копия конвертера пытается писать в тот же Excel файл, то
//                         программа валится.
//  <Причина>:  
//   <Решение>:  Показать индикатор, что процесс конвертации еще не 
//                         завершен, обработать исключительные ситуации.    
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.040>     <8.06. 2001 14:24>
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема 1>:   Необходимо выделять итоговые строчки жирным шрифтом
//  <Проблема 2>:   Необходимо выгружать таблицу без шапки.
//
//  <Причина>:
//   <Решение>: <1> В файле конфигураций описать список замен, куда можно
//                               включить и тэги выделения.
//                        <2> В файле конфигурации оприсать специальное слово NOHEAD 
//  <Дополнения>:   
//                          <1> Появилась возможность описать все параметры запуска в 
//                                в файле конфигуаций. Включены следующие cспец. слова:
//                              <SOURCE:>, <EXCELNAME:>, <LISTNAME>,
//                              <TEMPLATE>, <TEMPLATELIST>
//  <Пример:>
//      Название файла отчета или буффера   
//      SOURCE:"C:\$\redbaln.txt"
//      Имя ехсеl файла, куда конвертируется отчет
//      EXCELNAME:"C:\Ex.xls"
//      Название листа
//      LISTNAME:"peport" 
//      Имя файла шаблона (excel), по которому формируется шапка
//      TEMPLATE:"C:\Templ.xls"
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.041>     <28.08.2001 14:59>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>:  Сваливается когда в шапке объединяются ячейки 
//                          при использовании шаблона
//  <Причина>:  Данные продолжали писаться в шапку 
//   <Решение>:  Не давать писать в шапку
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.042>     <6.09.2001 15:09>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: проблемы с заполнением шаблона - шаблон грузится без
//              шапки, столбцы открываются, строки нет
//  <Причина>:  опечатки 
//  <Решение>:  исправили
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.043>     <18.09.2001 18:00>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Изменение>:    Договорились, что если флаг шапки = FALSE,
//              и имя шаблона не задано, то в качестве шаблона
//              используется основной Excel файл.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.044>     <2.10.2001 16:00>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Изменение>: Добавлена возможность раскрашивать столбцы отчета
//      при работе с шаблоном для этого достаточно раскрасить ячейку
//      в последней строке шапки нужным цветом и стилем.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.045>     <2.10.2001 16:00>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: Табуляция интерпретировалась не правильно - каждый
//              символ табуляции заменялся на заранее определенное кол. пробелов
//  <Решение>:  Написал функцию, которая подбирает необходимое количество пробелов
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.046>     <11.10.2001 13:55>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Изменения>: Внесена возможность форматировать строки текста 
//               (цвет, фон, размер, стиль и т.д.) по специальным тэгам,
//               которые описываются в файле конфигурации. 
//               TEXTFORMAT - ключевое слово для описания тэгов форматирования
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.047>     <25.10.2001 14:37>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: под Windows XP программа валилась 
//              в функции FillSafeArray на VariantClear
//  <Решение> : убрал эту функцию, так как она не особо нужна, но почему
//              валится так и не выяснил.
//
//  <Изменения 1>: Внесена возможность устанавливать нужный числовой формат столбца
//                 в шаблонном режиме по певой строке после шапки
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.048>     <13.12.2001 15:07>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации
//
//  <Проблема>: При объединении ячеек в аналоговой адрессации 
//              не правильно определяется адрес ячейки, т. к
//              адреса вычесляются по смещениюю
//
//  <Решение> : в таблице синонимов теперь хранятся не смещения, 
//              реальные адреса в виде [Cell1]_X .. A$5 
//  <Пример>:   m_ColMap[nameX1] :=  C$5
//              m_RowMap[nameY1] :=  B$10
//              RealCell = C10 - значение реальной ячейки       
//
//  <Изменения 1>: Внесена возможность устанавливать нужный числовой формат столбца
//                 в шаблонном режиме по певой строке после шапки
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.049> <17.12.2001 11:41>
//
//  <Логический модуль>: конвертация с использованием 
//  буфферной базы в аналоговой адресации
//
//  <Проблема>: 1. Даты не правильно преобразуются ... строчка
//                  воспринемается как формула:
//                 01\12\01 -> в число 
//              2. 01.12.01 -> 01,12,01 
//
//  <Решение> : 1. SetFormulaArray заменил на SetValue
//              2. (01.12.01 -> 01,12,01) Пока оставил как есть 
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.050>     <25.12.2001  11:10>
//
//  <Логический модуль>: конвертация с использованием 
//                       буфферной базы в аналоговой адресации 
//
//  <Проблема>: Конец таблицы определяется по первой пустой ячейке
//              - это не всегда удобно (в частности для форм из "консультанта")
//  <Решение>:  Конец таблицы определять по двум пустым ячейкам
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.051>     <15.01.2002  10:18>
//
//  <Логический модуль>: конвертация с использованием 
//                       буфферной базы
//
//  <Проблема>: 1. Не происходит переключения между разными 
//                 Excel файлами
//              2. При конвертации текстового отчета по шаблону
//                 по первой строчке надо сохранять не только
//                 формат ячейки, но и шрифт, и все что можно
//              3. После ззамены SetFormulaArray на SetValue
//                 все стало выгружаться в символьном виде
//                 заказчиков это не устраивает.
//              4. Заказчика не устраивает (Юкос), когда пред 
//                  балансовым счетом ставится "|"
//
//  <Решение 1>:  Переключать
//  <Решение 2>:  Распространять шрифт верхней ячейки столбца
//                  на весь столбец
//  <Решение 3>:  SetValue -> SetFormulaArray
//  <Решение 4>:  После распознавания дат и балансовых счетов перед
//                ним ставится пробел - это позволяет обманывать Excel
//                и выводить все в нужном виде  
//                   
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.052>     <4.02.2002  11:30>
//
//  <Логический модуль>: конвертация с использованием 
//                       буфферной базы
//
//  <Проблема 1>: Не переключаются листы
//  <Проблема 2>: Надо внести возможность скрывать строки 
//  <Проблема 3>: DYNHEADLINE не работает в шапке документа
//
//  <Решение 1>: Баг - не присваивал (oldList = nameList)  
//  <Решение 2>: Введено ключевое слово ROWHIDE: в файле конфигураций,
//               в котором описан тэг, отвечающий за скрытие строки
//     <Пример>: ROWHIDE: "clr"  ... в тексте отчета в нужной строке
//               надо поставить тэг <clr> .... text .... <clr\> -
//               - заключительный тэг <clr\> можно опустить
//
//  <Решение 3>: DYNHEADLINE работает теперь и в шапке документа
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.053>     <25.03.2002  11:38>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема 1>: При работе с шаблоном программ переформатирут шапку, что не всегда
//                правильно и удобно
//
//  <Решение 1>:  Ввел переменную которая считает разделительные линии
//                в шапке и по ее значению определяю, откуда надо форматировать таблицу
//                  
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.054>     <27.03.2002  11:38>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема 1>: Ошибка при генерации закрывающего тэга скрытия строк
//  <Проблема 2>: Если тэг скрытия строк стоит в конце, то строка не
//                всегда скрывается
//
//  <Решение 1>:  тэг закрытия стал: </tag> был <tag> 
//  <Решение 2>:  Обнаружилась недоработка в разборе тэгов - после разбора тэг скрытия не
//      входил в буфферный массив, поскольку он тоже разбирался по строке
//      форматирования.
//
//      @==== ==== ======== ===
//          [до разбора]
//  m1  <тэг>1      2      3    <cld>_!_  - строка с тэгами
//  m2   1      2       3   _!_            - строка без тэгов
//          [после разбора]
//      @==== ==== ======== ===   часть которая не разбирается
//  mm1 <тэг>|    | 2      |3  |  <cld>_!_
//  mm2 1    | 2  |      3 |_!_|
//    
//      Получается, что текст разбирется правильно, а тэг
//      учитыввается не всегда. Поэтому пока, чтобы все правильно
//      заработало, надо последнюю строку расширить, чтобы тэг скрытия
//      гарантировано попадал в буфферный массив разбора.
//      
//      Добавлена функция DivideFixTagPattern, которая производит пра
//      вильный разбор
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.055>     <25.04.2002  9:45>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: Необходимо удалять последовательности
//              x1b\x50, x1b\x53\x30, x1b\x54, x1b\x32, x1b\x41\x08
//
//  <Решение>:  Описал в ChangeTag [] новые заменяемые последова-
//              тельности.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.056>     <29.04.2002  10:10>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Изменения>: 1. Изменился механизм отчистки листа перед конвертированием.
//                  Если существует строка форматирования, то отчищается только
//                  область которую может занимать таблица (до строки 65535) 
//               2. Введен специальный тэг LEFTTEXT, который отменяет центрирование
//                  текст перед шапкой (если есть строка форматирования).
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.057>     <27.05.2002  9:57>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: Необходимо добавить возможность конвертировать отчет
//              сразу в несколько листов, имена которых будут перечислены
//              в файле конфигураций в тэге LISTNAME:
//
//  <Решение>:  В классе CStructCFG добавлен список листов m_ListName, куда
//              надо конвертировать отчет. В функцию ConvertTXT добавлен цикл,
//              который пробегает по всем листам описанным в файле
//              конфигураций.
//              
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  <Ver 2.058>     <20.08.2002  11:23>
//
//  <Логический модуль>: конвертация текстового отчета
//
//  <Проблема>: 1. даты дд.мм.гггг преобразовывались как дд,мм,гггг
//              2. окно сообщений сделать не модальным
//
//  <Решение>:  1. Доработал функцию convertNumber, где теперь по чесному распознаю даты
//              2. окно сообщений сделал не модальным

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.059>       <6.09.2002  13:23>

  <Логический модуль>: конвертация текстового отчета 
  
  <Проблема>: 1.    Если в параметрах запуска совместно с файлом конфигураций 
                казать лист, то отчет скопируется в два листа - в тот,
                который указан в шаблоне и тот который указан в параметрах
                запуска  (Лаптев)
               2.   Необходимо добавить возможность через файл конфигураций
                задавать имена листов, когда их в отчете несколько(Лаптев)

  <Решение>:  1.    Если лист задается в параметрах запуска, то
                колекция листов из файла конфигураций игнорируется -
                поставил m_ListName.RemoveAll()
              2.    Через PAGENAME можно задать имена листов для разных страниц отчета

        Пример: PAGENAME: "page1", "page2"

        Примечание 1: Если определен PAGENAME и LISTNAME c одним именем листа, 
                то названия листов будет браться из PAGENAME
                    
        Примечание 2: Если в LISTNAME определено несколько листов для копирования, 
                например, LISTNAME: "L1", "L2" и PAGENAME: "p1", "p2", то в результате
                получем 4 листа L1#p1, L2#p1, L1#p2, L2#p2.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.059>       <16.09.2002  17:43>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: Отчет с несколькими листами печатался поочередно в лист '0','1', ...
              (Ермолаева)

  <Решение>:  Неправильно вычислялись имена листов. Исправлено.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.060>       <18.09.2002  17:15>

  <Логический модуль>: конвертация текстового отчета (работа с шаблоном)

  <Проблема>: Формат данных столбцов, который определен в первой строке таблицы после шапки
              необходимо ставить до заполнения таблицы.
              Т.к. общий формат может изменять данные не нужным нам
              образом. Пример 0123 -> 123. (Худяков)

  <Решение>:  После отчистки таблицы сразу устанавливаем формат данных

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.061>       <17.12.2002  10:50>

  <Логический модуль>: конвертация текстового отчета (работа с шаблоном)

  <Проблема>: 1. Замена слов описанных в REPLACE должна проводится в первую очередь,
                а проводится для каждой строки при конвертации.
              2. В файле конфигурации необходимо указать вид кодировки.
              3. В шаблоне надо как-то указать с какой строки начинаются данные 
                 в текстовом файле. (Андреев А. В.)

  <Решение>:  1. Замену слов проводим в самую первую очередь - перенес замену из функции ConvertList
                 в ConvertTXT
              2. Введено специальное слово ENCODING = 'WIN(CP1251)/DOS(IBM-866)'
              3. В шаблоне в ячейке "A1" таблицы можно указать номер строки,
                  с которой начинаются данные в текстовом файле и в какую строку листа начинать
                  выводить.
              Пример: 5=5 - Из текстового отчета будет удалено первые 5 строк и в шаблон
                    данные будут выгружаться в 5 строку. Второе значение нужно для определения
                    положение данных в таблице в случае, ели в вырезанном тексте будет отсутствовать
                    строка форматирования (по которой обычно определяются данные)

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.062>       <9.12.2003  12:30>

  <Логический модуль>: конвертация с использованием 
                         буфферной базы

  <Проблема>: 1. Хочется использовать EConvert просто для открытия эксельных шаблонов (Ваня).
                В буферный файл записывается только имя файла. 

  <Решение>:  1. Сделана соответствующая проверка при загрузке (ф-ия convert): если лист
                не определен, данных нет (одна строка в базе, поля значения и примечания
                пусты), то грузим только книгу и выходим из программы .

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.063>       <21.01.2004  16:06>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: 1. Тэги REPLACE, DIV не всегда коректно работают. Это связано с неоднозна-
                чным перекодированием из кодировки cp866 в cp1251.   

  <Решение>:  1. Текст разбирается в DOS кодировке, а затем конвертируется в WIN. Раньше
                текст перекодировался перед разбором.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.064>       <13.02.2004  11:22>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: 1. Из отчета выкусывается буква 'д'

  <Решение>:  1. Была в списке замен. Убрал.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.065>       <13.02.2004  15:38>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: Сделать признаком шапки следующие последовательности '@-', '@=', '@ ' 
              и разрешить использовать разделители в строке форматирования шапки.

  <Решение>:  Готово.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.066>       <19.03.2004  16:28>

  <Логический модуль>: конвертация текстового отчета (с использованием шаблона)

  <Проблема>: 1. Необходимо скрывать некоторые колонки. 
              2. Шаблон должен всегда перегружать файл отчета.

  <Решение>:  1. В первой строке таблицы сразу после шапки шаблона в ячейке нужной колонки
                 нужно указать специальное слово, по которому программа будет определять
                 колнку, которую надо скрыть. В файле конфигураций есть спец. слово colhide
                 Пример: colhide: "colh". В тексте данный тэг представляется как 
                 <colh>.
              2. Теперь книга, куда конвертируется отчет принудительно выгружается, затем 
                 в файл отчета копируется шаблон, а уже затем происходит конвертация.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.067>       <25.03.2004  14:42>

  <Логический модуль>: конвертация текстового отчета (с использованием шаблона)

  <Проблема>: 1. Нет возможности для задания относительных путей для файла отчета и файла. 
                 шаблона.

  <Решение>:  1. Если задан относительный путь до шаблона, то полный путь вычисляется
                 по пути до файла конфигурации. Аналогично для файла отчета. Если ключевое 
                 слово TEMPLATE: в файле конфигураций есть, а имя не задано (либо задано ключевое
                 слово "CFG"), то оно вычисляется по пути до файла конфигурации + имя файла, 
                 куда конвертируется отчет.
                 Пример: 1. TEMPLATE:
                         2. TEMPLATE: "CFG"
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.068>       <26.04.2004  14:54>

  <Логический модуль>: конвертация текстового отчета (с использованием шаблона)

  <Проблема>: Необходимо после конвертации удалить некоторые листы. 

  <Решение>:  В файле конфигураций заведен специальный атрибут <POST_SCRIPT:>, в
              котором задано имя файла, где будет содержаться "скрипт". Если задан 
              относительный путь, то он будет вычислятся относительно файла конфигурации.
              Этот скрипт будет отрабатывать после конвертации отчета. После отработки
              скрипт автоматически !!!УДАЛЯЕТСЯ!!! 
              На данный момент скрипт может содержать одну команду <LIST_CLOSE>:
              Пример: 
                  LIST_CLOSE: "Лист1"
                  LIST_CLOSE: "Лист2"
                  LIST_CLOSE: "Лист3"
              В дальнейшем количество команд будет увеличиваться.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 2.069>       <10.05.2004  10:19>

  <Логический модуль>: конвертация текстового отчета (с использованием шаблона)

  <Проблема>: 1.Необходимо добавить в файл конфигурации атрибут указывающий на то,
                что не измененные листы необходимо удалить из книги. 
              2. Добавить новые команды (SELECT_LIST, DEL_SELECTED_LIST, DEL_NOT_SELECTED_LIST)
              3. Не всегда коректно работает тэг установки атрибутов ячейки <t></t> в 
                 случае если в строке уже открыт какой-либо тэг установки атрибутов. 

  <Решение>:  1. В файле конфигуратора можно использовать атрибут <DEL_NOT_CHANGED_LIST>,
                 который указывавет на то, что все не изменненые листы книги, куда
                 конвертируется отчет будут удалены. Если задан скрипт постобработки, то
                 действие данного атрибута будет (пока) отменено.

              2. Команда скрипта постобработки LIST_CLOSE !!!УДАЛЕНА!!!
              3. Почему-то для этого случая (Проблема 3) тэг закрытия удалялся. 
                 Возможно это фишка ранних версий:
                 VerSpcTag(): 1524:buffStr.Replace(pcfg->mTagFormat[i]->sEnd, ""); 
                 Сейчас эта строка закоментарена.
                
 <Изменения>:    Добавлены команды скрипта постобработки (POST_SCRIPT):
                    - отметить лист <SELECT_LIST:>
                    - удалить отмеченные листы <DEL_SELECTED_LIST:>
                    - удалить не отмеченные листы <DEL_NOT_SELECTED_LIST:>
                 Пример:
                 SELECT_LIST: "Лист1"
                 // Это коментарий
                 SELECT_LIST: "Лист3"
                 SELECT_LIST: "Лист4"
                 DEL_NOT_SELECTED_LIST:

///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 3.01>       <21.05.2004  13:41>

  <Логический модуль>: конвертация с использованием буфферной базы
                
  <Изменения>:  При использовании конвертера в режиме заполнения значений из
				буферной базы появилась возможность использовать файл скриптов,
				в котором можно указать команды пост и предобработки. Имя файла
				скриптов передается вторым параметром.
				
				Пример: econvert export.dbf script.scr

		В файле скриптов на данный момент можно использовать следующие 
		команды:
									Назначение
		---------------------------------------------------------------
		OPEN_WORKBOOK:				Открывает и делает текущей книгу   
			"name.xls"				- имя книги

		CLOSE_WORKBOOK:				Закрывает книгу	
			"name.xls"				- имя книги

		SELECT_LIST:				Выбирает лист из открытой книги  
			"List"					- имя листа, который надо выбрать	
			
		COPY_SELECTED_LIST:			Копирует выбранные листы
			"source.xls",			- имя книги, куда копируются листы
			"Лист1">				- имя листа после которого вставляются листы

		DEL_SELECTED_LIST:			Удаляет выделенные листы
					
		DEL_NOT_SELECTED_LIST:		Удаляет не выделенные листы

		DEL_FILE:					Удаляет файл	
			"name.xls"				- имя файла, который надо удалить

		COPY_FILE:					Копирует файл 
			"copyFrom.xls"			- имя файла, который копируется
			"copyTo.xls"			- имя файла, куда копируется

		Для того, чтобы задать команду предобработки необходимо задать
		перед командой префикс "PRE ". 

		!!! Ко всем относительным имена в скрипте
		добавляется путь до буферного файла <export.dbf>.
		1.xls (если б.ф. c:\!\export.dbf) -> c:\!\1.xls 

		Пример текста скрипта:

		//  Команды выполняемые перед конвертацией
		//  Удаляем временный файл отчета
		PRE DEL_FILE: "C:\$\VANIA\new.xls"

		//  Копируем нужные листы
		PRE OPEN_WORKBOOK: "C:\$\VANIA\oper02g.xls"
		PRE SELECT_LIST: "report"
		PRE COPY_SELECTED_LIST: "C:\$\VANIA\new.xls"

		//  Удаляем листы,  которые автоматически создаются после создания книги
		PRE OPEN_WORKBOOK: "C:\$\VANIA\new.xls"
		PRE SELECT_LIST: "Лист1"
		PRE SELECT_LIST: "Лист2"
		PRE SELECT_LIST: "Лист3"
		PRE DEL_SELECTED_LIST:

		PRE CLOSE_WORKBOOK: "oper02g.xls"

		//  Команды выполняемые после конвертации
		COPY_FILE: "C:\$\VANIA\new.xls",  "C:\$\VANIA\oldnew.xls"
	
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 3.02>       <19.08.2004  14:33>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: Если в отчете есть символ с кодом 0, то отчет обрезается после 
			  этого символа. 

  <Решение>:  Исправил баг. В цикле замены после замены 0 -> 32 стоял break 
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 3.03>       <29.10.2004  11:05>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: Формат переноса по словам и выравнивание не распространяется на всю колонку
			  таблицы.	

  <Решение>:  Добавил такую возможность
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
!!!!!!!!!!!!!!!!
<Ver 3.04> Скомпилировна на VC7 см. EConvVC7 - эта ветка теперь будет нумероватся
			с ver 4.0
!!!!!!!!!!!!!!!!
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 3.031>       <21.4.2005  13:14>

  <Логический модуль>: конвертация с использованием 
  буфферной базы в аналоговой адресации

  <Проблема>: При некоторых условиях не перегружалась ассоциативная таблица -
			при переключении на другой лист и использовании прямой адрессации вместе с
			аналоговой.

  <Решение>:  Исправил. Была логическая ошибка на условие перегрузкизки ассоциативной 
			таблицы.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

  <Ver 3.031>       <21.4.2005  13:14>

  <Логический модуль>: конвертация с использованием буфферной базы

  <Проблема>: Надо добавть команду MOVE_SELECTED_LIST.
  <Решение>: Добавил.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
  <Ver 3.033E>       <03.05.2005  12:54>

  <Логический модуль>: All

  <Проблема>: Выскакивает сообщение [ <Переключиться> <Повтор> <Отмена> ], когда
			  ячейка блокирова и туда пытаешся что-нибудь записать. 
  <Решение>: Создал функцию WaitRangeLock, которая вызывется перед тем как надо
			 изменить ячейку. Функция проверяе заблокирована ячейка или нет, если
			 заблокирована, то ждет когда разблокируется.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
  <Ver 3.04>       <11.05.2005  14:27>

  <Логический модуль>: конвертация текстового отчета

  <Проблема>: Необходимо добавить возможность импортировать файл конфигурации
              внешние конфигурационные файлы. 
			  
  <Решение>:  В конфигурационный файл добавлена инструкция  "#include". В качестве
	      параметра инструкции передается имя внешнего файла конфигурации.
              Если задано относительное имя, то берется путь файла конфигурации,
	      куда подгружаются внешние настройки (где вызывается инструкция #include).
			  
  Пример:	#include "color.cfg"
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
  <Ver 3.05>       <27.05.2005  9:02>

  <Логический модуль>: конвертация текстового отчета c шаблоном

  <Проблема>: Если имя шаблона не указано, а указана директория, то в качестве
              полного имени шаблона надо брать имя директории + имя файла отчета,
              которое берется из описания EXCELNAME. (Бусыгин Коля)
			  
  <Решение>:  Добавлена проверка на имя шаблона. Признаком директории является 
              отсутствее в имени шаблона подстроки ".xls".
  Пример:

  EXCELNAME: "C:\BAL\WRK\report1.xls"
  TEMPLATE: "C:\BAL\WRK\TEMPLATES"

  Шаблона будет браться из "C:\BAL\WRK\TEMPLATES\report1.xls".
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 3.1>       <6.02.2006  14:31>

  <Изменения>: Добавлен еще один параметр запуска программы, который задает серверный вариант работы 
               программы. Последним параметром можно указать параметр -srv - в этом случае программ 
			   все выводы будет вести в файл логов econvert.log в текцщей директории. 
				
				Ключевые слова лога:
				- "EXCELNAME:" - имя последней книги, куда производилась конвертация.
				- "ERROR": - Далее идет сообщение об ошибке. Программа прекратила работу.
				- "REPORT:" - Нейтральное сообщение.
				- "WARNING:" - Предупреждение. Программа продолжает работу.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 3.11>       <15.08.2006  11:55>

  <Изменения>: В функций WaitRangeLock изменил время ожидания снятия блокировки серввером с 
	           20 до 100 циклов.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 4.01>       <16.10.2006  14:17>

  <Изменения>: Перекомпилировал проект под VS2003. Добавлена поддержка тэга открытия 
               скрытых колонок. В файле конфигураций тэг открытия описывается по
               ключу colshow.
  Пример:
  colshow: "cols"
  colhide: "colh"
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 4.02>       <20.12.2006  11:30>
  <Логический модуль>: конвертация текстового отчета
  <Проблема>: В постобработке необходимо удалять столбцы (Худяков).
  <Решение>: В скрипте постобработки добавлена команда DEL_COL.
  
  Пример:
	SELECT_LIST: "Лист1"
	DEL_COL: "A"
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 4.03>       <16.02.2007  14:32>
  <Логический модуль>: конвертация текстового отчета
  <Проблема>: Не все данные отображаются в таблице (Лаптев).
  <Решение>: В функции convertList(...): строка 1856 заменил фунцию для передачи массива подготовленных данных.
		было - oRange.SetFormulaArray(COleVariant(saRet));
		(заменил на) -> oRange.SetFormula(COleVariant(saRet));
	Причина не известна. 
  
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 4.031>       <14.11.2007  16:32>
  <Логический модуль>: конвертация текстового отчета
  <Проблема>: Данные не преобразуются к нужным типам (Лаптев).
  <Решение>: В функции convertList(...): строка 1856 поменял на старый вариант.
		было - oRange.SetFormula(COleVariant(saRet));
		(заменил на) -> oRange.SetFormulaArray(COleVariant(saRet));
	Данные не отображаются если текст начинается с '-'. SetFormulaArray внутри где-то
	падает и не отображает данные. Это особенность Excel 2003+sp, 2007. Для решения этой
	проблемы надо избавиться от '-' в начале строки (самое простое заменой ' - ' на ' _ ' 
	в REPLACE конфигурационного файла).

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 4.032>       <14.11.2007  16:32>
Возврат к 4.02. Ставим oRange.SetFormulaArray(COleVariant(saRet)) - это нужно для правильного установления типов
в Excel2007 это работает не так как раньше.

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 4.031>       <14.11.2007  16:32>
  <Логический модуль>: конвертация с использованием буфферной базы
  <Проблема>: Форматирование ячеек (Милешкина).
  <Решение>: В поле примечания (PRIM) стиль задается следующим образом 
  (также как ключ TEXTFORMAT в конфигурационном файле):
  :textformat: "a", "000000","ffffff", "f","t", "f", "Arial Cyr", "10" - на текущую ячейку, 
	задаваемую в посе CELL;
	или аналогичная запись
  :tf: "b", "000000","ffffff", "f","t","f","Arial Cyr","10"

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
<Ver 5.01>       <13.07.2015>
    <Перевод утилита на Linux>
  